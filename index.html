<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>SISOV PRO v3.0 lite (estable) | Sistema Inteligente</title>
    
    <!-- CDNs Optimizados -->
    <script src="https://cdn.jsdelivr.net/npm/pocketbase@0.21.1/dist/pocketbase.umd.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4f46e5',
                        'primary-dark': '#4338ca',
                        secondary: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    
    <!-- QR Scanner -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <!-- Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- SweetAlert2 para mejores alertas -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --radius: 1rem;
        }
        
        /* Reset y Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Glass Effect */
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        .animate-pulse {
            animation: pulse 2s infinite;
        }
        
        /* Scroll Personalizado */
        .scroll-thin::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        
        .scroll-thin::-webkit-scrollbar-track {
            background: rgba(241, 245, 249, 0.5);
            border-radius: 10px;
        }
        
        .scroll-thin::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        
        .scroll-thin::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Tabs */
        .tab-content {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Cards Hover */
        .card-hover {
            transition: all 0.2s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.1);
        }
        
        /* Botones */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(79, 70, 229, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--secondary), #059669);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }
        
        /* Inputs */
        .input-field {
            background: white;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        /* Responsive Design */
        @media (max-width: 640px) {
            .mobile-stack {
                flex-direction: column !important;
            }
            
            .mobile-full {
                width: 100% !important;
            }
            
            .mobile-padding {
                padding: 1rem !important;
            }
            
            .mobile-text-sm {
                font-size: 0.875rem !important;
            }
            
            .mobile-hide {
                display: none !important;
            }
        }
        
        @media (min-width: 641px) and (max-width: 1024px) {
            .tablet-grid-2 {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }
        
        /* Loading States */
        .skeleton {
            background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Modal Backdrop */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }
        
        .modal-backdrop.active {
            display: flex;
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            z-index: 9999;
            animation: fadeIn 0.3s ease-out;
        }
        
        .toast-success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .toast-error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .toast-info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        
        /* Table Styles */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .table-striped tbody tr:nth-child(odd) {
            background-color: rgba(241, 245, 249, 0.5);
        }
        
        /* Product Grid */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        @media (max-width: 640px) {
            .product-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Badge Status */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-success {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .badge-warning {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .badge-danger {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        /* Gradient Text */
        .gradient-text {
            background: linear-gradient(135deg, var(--primary), #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body>
    <!-- Contenedor Principal -->
    <div id="app" class="min-h-screen">
        <!-- Vista de Login -->
        <div id="loginView" class="min-h-screen flex items-center justify-center p-4">
            <div class="glass rounded-3xl p-8 md:p-12 w-full max-w-md border border-slate-200 shadow-2xl animate-fade-in">
                
                <!-- Logo -->
                <div class="text-center mb-10">
                    <div class="flex justify-center mb-6">
                        <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-primary to-purple-600 flex items-center justify-center shadow-lg">
                            <i data-lucide="bar-chart-3" class="w-10 h-10 text-white"></i>
                        </div>
                    </div>
                    <h1 class="text-4xl font-black mb-2 gradient-text">SISOV PRO v3.0(beta)</h1>
                    <p class="text-slate-500 text-sm uppercase tracking-wider font-medium">v3.0(lite/beta/estable)</p>
                    <p class="text-slate-500 text-xs mt-2">Sistema Inteligente de Operaciones</p>
                    <p class="text-[10px] text-blue-300 italic">Core Base para nuevos desarrollos</p>
                </div>
                
                <!-- Formulario de Login -->
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label class="block text-slate-700 text-sm font-semibold mb-2" for="email">
                            Correo Electrónico
                        </label>
                        <div class="relative">
                            <i data-lucide="user" class="absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5"></i>
                            <input type="email" 
                                   id="email" 
                                   required
                                   placeholder="usuario@empresa.com"
                                   class="input-field w-full pl-12 pr-4 py-3 rounded-xl text-slate-800 placeholder-slate-400 outline-none focus:outline-none">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-slate-700 text-sm font-semibold mb-2" for="password">
                            Contraseña
                        </label>
                        <div class="relative">
                            <i data-lucide="lock" class="absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5"></i>
                            <input type="password" 
                                   id="password" 
                                   required
                                   placeholder="••••••••"
                                   class="input-field w-full pl-12 pr-4 py-3 rounded-xl text-slate-800 placeholder-slate-400 outline-none focus:outline-none">
                        </div>
                    </div>
                    
                    <button type="submit" 
                            id="loginBtn"
                            class="btn-primary w-full py-4 rounded-xl text-white font-bold text-lg flex items-center justify-center gap-3">
                        <i data-lucide="log-in" class="w-5 h-5"></i>
                        <span>INICIAR SESIÓN</span>
                    </button>

                    <div class="text-center">
                        <div class="flex items-center justify-center space-x-2 my-4">
                            <div class="h-px w-16 bg-slate-300"></div>
                            <span class="text-slate-500 text-xs font-semibold">ACCESO SEGURO</span>
                            <div class="h-px w-16 bg-slate-300"></div>
                        </div>
                        
                        <div class="p-4 bg-slate-50 rounded-xl border border-slate-200">
                            <div class="flex items-center justify-center gap-2 mb-2">
                                <i data-lucide="shield" class="w-4 h-4 text-emerald-500"></i>
                                <span class="text-xs text-slate-600 font-semibold">Sistema Seguro</span>
                            </div>
                            <p class="text-xs text-slate-500">
                                Sus credenciales están protegidas con cifrado AES-256
                            </p>
                        </div>
                    </div>
                </form>
                
                <!-- Estado del Sistema -->
                <div id="systemStatus" class="mt-8 p-4 bg-slate-50 rounded-xl border border-slate-200">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                            <span id="statusText" class="text-xs text-slate-600">Verificando servidor...</span>
                        </div>
                        <span id="serverStatus" class="text-xs text-slate-400">Conectando...</span>
                    </div>
                </div>
                
                <!-- Footer -->
                <div class="mt-10 pt-6 border-t border-slate-200 text-center">
                    <p class="text-xs text-slate-500">
                        © 2024 SISOV PRO v3.0(lite/estable) - Todos los derechos reservados
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Vista Principal (Oculta inicialmente) -->
        <div id="mainView" class="hidden">
            <!-- Header -->
            <header class="glass border-b border-slate-200 sticky top-0 z-50">
                <div class="max-w-7xl mx-auto px-4 py-3">
                    <div class="flex flex-col sm:flex-row justify-between items-center gap-3">
                        <!-- Logo -->
                        <div class="flex items-center gap-3">
                            <div class="bg-gradient-to-br from-primary to-purple-600 w-10 h-10 rounded-xl flex items-center justify-center shadow-md">
                                <i data-lucide="bar-chart-3" class="w-6 h-6 text-white"></i>
                            </div>
                            <div>
                                <span class="font-black text-xl text-slate-800">SISOV PRO</span>
                                <span class="text-[10px] font-bold text-primary ml-2">v3.0/(lite/estable)</span>
                            </div>
                        </div>
                        
                        <!-- Tasa BCV -->
                        <div class="cursor-pointer" onclick="Sistema.mostrarModalTasa()">
                            <div class="flex items-center bg-gradient-to-r from-emerald-50 to-green-50 border border-emerald-200 px-3 py-2 rounded-xl shadow-sm">
                                <div class="flex flex-col leading-none mr-3 border-r border-emerald-200 pr-3">
                                    <span class="text-[8px] font-bold text-emerald-700 uppercase">TASA BCV</span>
                                </div>
                                <div class="flex items-baseline gap-1">
                                    <span id="rateValue" class="text-lg font-bold text-emerald-800">--.--</span>
                                    <span class="text-[10px] font-bold text-emerald-700">Bs/$</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Usuario -->
                        <div class="flex items-center gap-3">
                            <div class="hidden sm:block text-right">
                                <span class="text-sm font-bold text-slate-700">¡Hola, <span id="userName" class="text-primary">Usuario</span>!</span>
                                <span id="userRole" class="text-xs text-slate-500 block">Cargando...</span>
                            </div>
                            <div class="w-10 h-10 bg-gradient-to-br from-primary to-purple-600 rounded-full flex items-center justify-center text-white font-bold">
                                <i data-lucide="user" class="w-5 h-5"></i>
                            </div>
                            <button onclick="Sistema.cerrarSesion()" 
                                    class="p-2 text-slate-500 hover:text-danger transition-colors">
                                <i data-lucide="log-out" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Navegación -->
            <nav class="bg-white border-b border-slate-200">
                <div class="max-w-7xl mx-auto px-4">
                    <div class="flex overflow-x-auto scroll-thin">
                        <button onclick="Sistema.cambiarTab('ventas')" 
                                class="tab-btn flex-shrink-0 px-4 py-3 text-sm font-semibold border-b-2 border-transparent hover:text-primary transition-all"
                                data-tab="ventas">
                            <i data-lucide="shopping-cart" class="w-4 h-4 inline mr-2"></i>
                            Ventas
                        </button>
                        <button onclick="Sistema.cambiarTab('inventario')" 
                                class="tab-btn flex-shrink-0 px-4 py-3 text-sm font-semibold border-b-2 border-transparent hover:text-primary transition-all"
                                data-tab="inventario">
                            <i data-lucide="package" class="w-4 h-4 inline mr-2"></i>
                            Inventario
                        </button>
                        <button onclick="Sistema.cambiarTab('reportes')" 
                                class="tab-btn flex-shrink-0 px-4 py-3 text-sm font-semibold border-b-2 border-transparent hover:text-primary transition-all"
                                data-tab="reportes">
                            <i data-lucide="bar-chart-3" class="w-4 h-4 inline mr-2"></i>
                            Reportes
                        </button>
                        <button onclick="Sistema.cambiarTab('configuracion')" 
                                class="tab-btn flex-shrink-0 px-4 py-3 text-sm font-semibold border-b-2 border-transparent hover:text-primary transition-all"
                                data-tab="configuracion">
                            <i data-lucide="settings" class="w-4 h-4 inline mr-2"></i>
                            Configuración
                        </button>
                    </div>
                </div>
            </nav>
            
            <!-- Contenido Principal -->
            <main class="max-w-7xl mx-auto p-4 md:p-6">
                <!-- Pestaña: Ventas -->
                <div id="tabVentas" class="tab-content active">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Productos -->
                        <div class="lg:col-span-2">
                            <div class="flex flex-col sm:flex-row gap-3 mb-6">
                                <div class="relative flex-1">
                                    <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5"></i>
                                    <input type="text" 
                                           id="searchProducts" 
                                           placeholder="Buscar producto..." 
                                           class="w-full pl-10 pr-4 py-3 rounded-xl border-2 border-slate-200 focus:border-primary outline-none transition-all">
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="Ventas.iniciarScanner()" 
                                            class="btn-primary px-4 py-3 rounded-xl flex items-center gap-2">
                                        <i data-lucide="camera" class="w-4 h-4"></i>
                                        <span class="text-sm font-semibold">Escanear</span>
                                    </button>
                                    <button onclick="Inventario.mostrarModalProducto()" 
                                            class="bg-slate-800 text-white px-4 py-3 rounded-xl flex items-center gap-2">
                                        <i data-lucide="plus" class="w-4 h-4"></i>
                                        <span class="text-sm font-semibold">Nuevo</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Grid de Productos -->
                            <div id="productGrid" class="product-grid">
                                <!-- Productos cargados dinámicamente -->
                            </div>
                        </div>
                        
                        <!-- Carrito -->
                        <div class="lg:col-span-1">
                            <div class="bg-white rounded-2xl shadow-lg border border-slate-200 sticky top-24">
                                <div class="p-6 border-b border-slate-200">
                                    <h2 class="font-bold text-slate-800 flex items-center gap-2">
                                        <i data-lucide="shopping-bag" class="w-5 h-5 text-primary"></i>
                                        Carrito de Venta
                                        <span id="cartCount" class="ml-auto bg-primary text-white text-xs font-bold px-2 py-1 rounded-full">0</span>
                                    </h2>
                                </div>
                                
                                <!-- Items del Carrito -->
                                <div id="cartItems" class="p-4 space-y-3 max-h-96 overflow-y-auto scroll-thin">
                                    <!-- Items cargados dinámicamente -->
                                </div>
                                
                                <!-- Total -->
                                <div class="border-t border-slate-200 p-6">
                                    <div class="space-y-3 mb-6">
                                        <div class="flex justify-between items-center">
                                            <span class="text-slate-600">Subtotal USD:</span>
                                            <span id="subtotalUSD" class="font-bold">$0.00</span>
                                        </div>
                                        <div class="flex justify-between items-center text-lg font-bold">
                                            <span class="text-slate-800">Total Bs:</span>
                                            <span id="totalVES" class="text-primary">0.00 Bs</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Método de Pago -->
                                    <div class="mb-6">
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">Método de Pago</label>
                                        <div class="grid grid-cols-2 gap-2">
                                            <button onclick="Ventas.seleccionarMetodoPago('EFECTIVO')" 
                                                    class="payment-method p-2 bg-slate-100 rounded-lg text-sm font-semibold border-2 border-transparent"
                                                    data-method="EFECTIVO">
                                                Efectivo
                                            </button>
                                            <button onclick="Ventas.seleccionarMetodoPago('PAGO_MOVIL')" 
                                                    class="payment-method p-2 bg-slate-100 rounded-lg text-sm font-semibold border-2 border-transparent"
                                                    data-method="PAGO_MOVIL">
                                                Pago Móvil
                                            </button>
                                            <button onclick="Ventas.seleccionarMetodoPago('DIVISAS')" 
                                                    class="payment-method p-2 bg-slate-100 rounded-lg text-sm font-semibold border-2 border-transparent"
                                                    data-method="DIVISAS">
                                                Divisas
                                            </button>
                                            <button onclick="Ventas.seleccionarMetodoPago('MIXTO')" 
                                                    class="payment-method p-2 bg-slate-100 rounded-lg text-sm font-semibold border-2 border-transparent"
                                                    data-method="MIXTO">
                                                Mixto
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Botones de Acción -->
                                    <div class="space-y-3">
                                        <button onclick="Ventas.procesarVenta()" 
                                                id="btnProcesarVenta"
                                                class="btn-primary w-full py-3 rounded-xl font-bold text-white flex items-center justify-center gap-2 disabled:opacity-50">
                                            <i data-lucide="credit-card" class="w-5 h-5"></i>
                                            Procesar Venta
                                        </button>
                                        <button onclick="Ventas.vaciarCarrito()" 
                                                class="w-full py-3 bg-slate-100 text-slate-600 rounded-xl font-semibold hover:bg-slate-200 transition-colors">
                                            Vaciar Carrito
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Pestaña: Inventario -->
                <div id="tabInventario" class="tab-content">
                    <div class="bg-white rounded-2xl shadow-lg border border-slate-200">
                        <div class="p-6 border-b border-slate-200">
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                                <div>
                                    <h2 class="text-xl font-bold text-slate-800 mb-2">Gestión de Inventario</h2>
                                    <p class="text-slate-600">Control total de stock y productos</p>
                                </div>
                                <button onclick="Inventario.mostrarModalProducto()" 
                                        class="btn-primary px-4 py-3 rounded-xl font-semibold text-white flex items-center gap-2">
                                    <i data-lucide="plus" class="w-4 h-4"></i>
                                    Nuevo Producto
                                </button>
                            </div>
                            
                            <!-- Filtros y Búsqueda -->
                            <div class="flex flex-col sm:flex-row gap-4">
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="Inventario.filtrarProductos('todos')" 
                                            class="px-3 py-2 bg-primary text-white text-sm font-semibold rounded-lg">
                                        Todos
                                    </button>
                                    <button onclick="Inventario.filtrarProductos('bajo')" 
                                            class="px-3 py-2 bg-warning text-white text-sm font-semibold rounded-lg">
                                        Stock Bajo
                                    </button>
                                    <button onclick="Inventario.filtrarProductos('agotado')" 
                                            class="px-3 py-2 bg-danger text-white text-sm font-semibold rounded-lg">
                                        Agotados
                                    </button>
                                </div>
                                <div class="relative flex-1">
                                    <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"></i>
                                    <input type="text" 
                                           id="searchInventory" 
                                           placeholder="Buscar producto..." 
                                           class="w-full pl-10 pr-4 py-2 rounded-lg border border-slate-300 focus:border-primary outline-none">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tabla de Inventario -->
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-slate-50">
                                    <tr>
                                        <th class="p-4 text-left text-sm font-semibold text-slate-700">Producto</th>
                                        <th class="p-4 text-left text-sm font-semibold text-slate-700">SKU</th>
                                        <th class="p-4 text-left text-sm font-semibold text-slate-700">Stock</th>
                                        <th class="p-4 text-left text-sm font-semibold text-slate-700">Precio USD</th>
                                        <th class="p-4 text-left text-sm font-semibold text-slate-700">Categoría</th>
                                        <th class="p-4 text-left text-sm font-semibold text-slate-700">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="inventoryTable" class="divide-y divide-slate-200">
                                    <!-- Productos cargados dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Pestaña: Reportes -->
                <div id="tabReportes" class="tab-content">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Estadísticas -->
                        <div class="lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-gradient-to-br from-primary to-purple-600 text-white p-6 rounded-2xl">
                                <div class="flex items-center justify-between mb-4">
                                    <i data-lucide="dollar-sign" class="w-8 h-8 opacity-90"></i>
                                    <span class="text-xs font-bold bg-white/20 px-2 py-1 rounded">HOY</span>
                                </div>
                                <p class="text-sm opacity-90">Ventas USD</p>
                                <h3 id="ventasHoyUSD" class="text-2xl font-bold">$0.00</h3>
                            </div>
                            <div class="bg-white p-6 rounded-2xl shadow border border-slate-200">
                                <div class="flex items-center justify-between mb-4">
                                    <i data-lucide="trending-up" class="w-8 h-8 text-primary"></i>
                                </div>
                                <p class="text-sm text-slate-600">Ventas Bs</p>
                                <h3 id="ventasHoyVES" class="text-2xl font-bold text-slate-800">0.00 Bs</h3>
                            </div>
                            <div class="bg-white p-6 rounded-2xl shadow border border-slate-200">
                                <div class="flex items-center justify-between mb-4">
                                    <i data-lucide="package" class="w-8 h-8 text-primary"></i>
                                </div>
                                <p class="text-sm text-slate-600">Transacciones</p>
                                <h3 id="transaccionesHoy" class="text-2xl font-bold text-slate-800">0</h3>
                            </div>
                        </div>
                        
                        <!-- Gráfico -->
                        <div class="lg:col-span-2">
                            <div class="bg-white p-6 rounded-2xl shadow border border-slate-200">
                                <h3 class="text-lg font-bold text-slate-800 mb-4">Ventas del Mes</h3>
                                <canvas id="salesChart" class="w-full h-64"></canvas>
                            </div>
                        </div>
                        
                        <!-- Top Productos -->
                        <div class="lg:col-span-1">
                            <div class="bg-white p-6 rounded-2xl shadow border border-slate-200">
                                <h3 class="text-lg font-bold text-slate-800 mb-4">Productos más Vendidos</h3>
                                <div id="topProducts" class="space-y-3">
                                    <!-- Productos cargados dinámicamente -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tabla de Ventas -->
                        <div class="lg:col-span-3">
                            <div class="bg-white rounded-2xl shadow border border-slate-200">
                                <div class="p-6 border-b border-slate-200">
                                    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                                        <div class="flex items-center gap-4">
                                            <input type="date" 
                                                   id="reportDate" 
                                                   class="px-4 py-2 border border-slate-300 rounded-lg">
                                            <div class="relative">
                                                <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"></i>
                                                <input type="text" 
                                                       id="searchReports" 
                                                       placeholder="Buscar venta..." 
                                                       class="pl-10 pr-4 py-2 border border-slate-300 rounded-lg">
                                            </div>
                                        </div>
                                        <button onclick="Reportes.exportarPDF()" 
                                                class="btn-primary px-4 py-2 rounded-lg text-white font-semibold flex items-center gap-2">
                                            <i data-lucide="download" class="w-4 h-4"></i>
                                            Exportar PDF
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead class="bg-slate-50">
                                            <tr>
                                                <th class="p-4 text-left text-sm font-semibold text-slate-700">Factura</th>
                                                <th class="p-4 text-left text-sm font-semibold text-slate-700">Fecha</th>
                                                <th class="p-4 text-left text-sm font-semibold text-slate-700">Cliente</th>
                                                <th class="p-4 text-left text-sm font-semibold text-slate-700">Total USD</th>
                                                <th class="p-4 text-left text-sm font-semibold text-slate-700">Total Bs</th>
                                                <th class="p-4 text-left text-sm font-semibold text-slate-700">Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="salesTable" class="divide-y divide-slate-200">
                                            <!-- Ventas cargadas dinámicamente -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
<!--============================= Pestaña: Configuración=============================================== -->
             <!-- Reemplaza TODO el contenido de tabConfiguracion con esto: -->
<div id="tabConfiguracion" class="tab-content">
    <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-6">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-xl font-bold text-slate-800">Configuración del Sistema</h2>
                <p class="text-slate-600 text-sm">Administración y preferencias</p>
            </div>
            
            <!-- BOTÓN DE CREAR USUARIO -->
            <button onclick="window.location.href='crear-usuario.html'" 
                    class="btn-primary px-6 py-3 rounded-xl font-semibold text-white flex items-center gap-2 hover:shadow-lg transition-all">
                <i data-lucide="user-plus" class="w-5 h-5"></i>
                Crear Nuevo Usuario
            </button>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Sección Tasa BCV -->
            <div class="bg-slate-50 p-6 rounded-xl">
                <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                    <i data-lucide="dollar-sign" class="w-5 h-5 text-primary"></i>
                    Tasa de Cambio
                </h3>
                <!-- ... contenido existente ... -->
            </div>
            
            <!-- Sección Usuarios -->
            <div class="bg-slate-50 p-6 rounded-xl">
                <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                    <i data-lucide="users" class="w-5 h-5 text-primary"></i>
                    Gestión de Usuarios
                </h3>
                <div class="space-y-4">
                    <p class="text-sm text-slate-600">
                        Administra los usuarios del sistema. Solo administradores pueden crear nuevos usuarios.
                    </p>
                    <div class="space-y-3">
                        <button onclick="window.location.href='crear-usuario.html'" 
                                class="w-full btn-primary py-3 rounded-lg text-white font-semibold flex items-center justify-center gap-2">
                            <i data-lucide="user-plus" class="w-4 h-4"></i>
                            Crear Nuevo Usuario
                        </button>
                        <button onclick="Configuracion.cargarUsuarios()" 
                                class="w-full py-3 bg-slate-200 text-slate-700 rounded-lg font-semibold flex items-center justify-center gap-2 hover:bg-slate-300">
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                            Actualizar Lista
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Lista de Usuarios -->
        <div class="mt-6 bg-slate-50 p-6 rounded-xl">
            <h3 class="text-lg font-semibold text-slate-800 mb-4">Usuarios Registrados</h3>
            <div id="usersList" class="space-y-3">
                <!-- Los usuarios se cargarán aquí -->
                <div class="text-center py-8 text-slate-400">
                    <i data-lucide="users" class="w-12 h-12 mx-auto mb-3 opacity-30"></i>
                    <p class="text-sm font-medium">Cargando usuarios...</p>
                </div>
            </div>
        </div>
    </div>
</div>
<!--==================================================================================================0-->
            </main>
        </div>
    </div>
    
    <!-- Modales -->
    <div id="modalTasa" class="modal-backdrop">
        <div class="bg-white rounded-2xl shadow-xl max-w-md w-full mx-4">
            <div class="p-6 border-b border-slate-200">
                <h3 class="text-lg font-bold text-slate-800">Configurar Tasa BCV</h3>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Tasa Actual de Referencia</label>
                        <div class="bg-emerald-50 p-4 rounded-lg mb-4">
                            <div class="flex items-center justify-between">
                                <span class="text-2xl font-bold text-emerald-700" id="referenciaRate">--.--</span>
                                <button onclick="Sistema.obtenerTasaReferencia()" 
                                        class="text-sm text-emerald-600 hover:text-emerald-800">
                                    Actualizar
                                </button>
                            </div>
                            <p class="text-xs text-emerald-600 mt-1">Fuente: DolarAPI</p>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Tasa Manual</label>
                        <input type="number" 
                               step="0.01" 
                               id="tasaManualInput" 
                               placeholder="Ingrese tasa manual"
                               class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-primary outline-none">
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                        <button onclick="Sistema.cerrarModalTasa()" 
                                class="flex-1 py-3 bg-slate-100 text-slate-700 rounded-xl font-semibold hover:bg-slate-200 transition-colors">
                            Cancelar
                        </button>
                        <button onclick="Sistema.guardarTasaManual()" 
                                class="flex-1 py-3 bg-primary text-white rounded-xl font-semibold hover:bg-primary-dark transition-colors">
                            Guardar Tasa
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Producto -->
    <div id="modalProducto" class="modal-backdrop">
        <div class="bg-white rounded-2xl shadow-xl max-w-md w-full mx-4">
            <div class="p-6 border-b border-slate-200">
                <h3 class="text-lg font-bold text-slate-800" id="modalProductTitle">Nuevo Producto</h3>
            </div>
            <div class="p-6">
                <form id="productForm" class="space-y-4">
                    <input type="hidden" id="productId">
                    
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Nombre del Producto</label>
                        <input type="text" 
                               id="productName" 
                               required
                               placeholder="Ej: Arroz"
                               class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-primary outline-none">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">SKU</label>
                            <input type="text" 
                                   id="productSKU" 
                                   required
                                   placeholder="PROD-001"
                                   class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-primary outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Categoría</label>
                            <input type="text" 
                                   id="productCategory" 
                                   placeholder="General"
                                   class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-primary outline-none">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Precio USD</label>
                            <input type="number" 
                                   step="0.01" 
                                   id="productPrice" 
                                   required
                                   placeholder="0.00"
                                   class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-primary outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Stock</label>
                            <input type="number" 
                                   id="productStock" 
                                   required
                                   placeholder="0"
                                   class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:border-primary outline-none">
                        </div>
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                        <button type="button" 
                                onclick="Inventario.cerrarModalProducto()" 
                                class="flex-1 py-3 bg-slate-100 text-slate-700 rounded-xl font-semibold hover:bg-slate-200 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" 
                                class="flex-1 py-3 bg-primary text-white rounded-xl font-semibold hover:bg-primary-dark transition-colors">
                            Guardar Producto
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal QR Scanner -->
    <div id="modalScanner" class="modal-backdrop">
        <div class="bg-white rounded-2xl shadow-xl max-w-md w-full mx-4">
            <div class="p-6 border-b border-slate-200">
                <h3 class="text-lg font-bold text-slate-800">Escáner de Códigos QR</h3>
            </div>
            <div class="p-6">
                <div id="qr-reader" class="w-full h-64 mb-4"></div>
                <div class="flex gap-3">
                    <button onclick="Ventas.detenerScanner()" 
                            class="flex-1 py-3 bg-slate-100 text-slate-700 rounded-xl font-semibold hover:bg-slate-200 transition-colors">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts del Sistema -->
     
    
    <script>

    // 1. DECLARACIÓN ÚNICA Y GLOBAL

    var pb = new PocketBase('https://sisov-pro-react-production.up.railway.app');
    window.pb = pb; // Esto le abre la puerta al parche

        // ===== SISTEMA PRINCIPAL =====
        const Sistema = {
            // Estado global
            estado: {
                usuario: null,
                tasaBCV: 0,
                productos: [],
                carrito: [],
                ventas: [],
                config: {
                    tasaManual: false,
                    serverTime: null
                }
            },
            
            // Inicialización
            async inicializar() {
                // Inicializar íconos
                lucide.createIcons();
                
                // Verificar autenticación
                await this.verificarAutenticacion();
                
                // Cargar datos iniciales
                await this.cargarDatosIniciales();
                
                // Configurar eventos
                this.configurarEventos();
                
                // Actualizar hora del servidor
                this.actualizarHoraServidor();
            },
            
            // Autenticación
            async verificarAutenticacion() {
                try {
                    const token = localStorage.getItem('sisov_token');
                    const userData = localStorage.getItem('sisov_user');
                    
                    if (token && userData) {
                        this.estado.usuario = JSON.parse(userData);
                        this.mostrarVistaPrincipal();
                        return true;
                    }
                } catch (error) {
                    console.error('Error verificando autenticación:', error);
                }
                return false;
            },
            
            async iniciarSesion(email, password) {
                try {
                    // Configurar PocketBase
                    pb = new PocketBase('https://sisov-pro-react-production.up.railway.app');
                    
                    
                    // Autenticar
                    const authData = await pb.collection('users').authWithPassword(email, password);
                    
                    if (authData && authData.token) {
                        // Guardar datos
                        this.estado.usuario = {
                            id: authData.record.id,
                            email: authData.record.email,
                            nombre: authData.record.user_name || 'Usuario',
                            rol: authData.record.user_role || 'user'
                        };
                        
                        localStorage.setItem('sisov_token', authData.token);
                        localStorage.setItem('sisov_user', JSON.stringify(this.estado.usuario));
                        
                        this.mostrarToast('Sesión iniciada correctamente', 'success');
                        this.mostrarVistaPrincipal();
                        
                        return true;
                    }
                } catch (error) {
                    console.error('Error en inicio de sesión:', error);
                    this.mostrarToast('Credenciales incorrectas', 'error');
                }
                return false;
            },
            
            cerrarSesion() {
                Swal.fire({
                    title: '¿Cerrar sesión?',
                    text: 'Selecciona una opción',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Cerrar',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    if (result.isConfirmed) {
                        localStorage.clear();
                        this.estado.usuario = null;
                        this.estado.carrito = [];
                        
                        document.getElementById('loginView').classList.remove('hidden');
                        document.getElementById('mainView').classList.add('hidden');
                        
                        this.mostrarToast('Sesión cerrada', 'info');
                    }
                });
            },
            
            // Vistas
            mostrarVistaPrincipal() {
                document.getElementById('loginView').classList.add('hidden');
                document.getElementById('mainView').classList.remove('hidden');
                
                // Actualizar UI
                this.actualizarUIUsuario();
                this.cambiarTab('ventas');
                
                // Cargar productos
                Inventario.cargarProductos();
            },
            
            actualizarUIUsuario() {
                if (this.estado.usuario) {
                    document.getElementById('userName').textContent = this.estado.usuario.nombre;
                    document.getElementById('userRole').textContent = this.estado.usuario.rol.toUpperCase();
                }
            },
            
            // Tabs
            cambiarTab(tabId) {
                // Ocultar todos los tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Quitar activo de botones
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('border-primary', 'text-primary');
                    btn.classList.add('border-transparent', 'text-slate-600');
                });
                
                // Mostrar tab seleccionado
                const tab = document.getElementById(`tab${tabId.charAt(0).toUpperCase() + tabId.slice(1)}`);
                if (tab) {
                    tab.classList.add('active');
                }
                
                // Activar botón
                const btn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
                if (btn) {
                    btn.classList.remove('border-transparent', 'text-slate-600');
                    btn.classList.add('border-primary', 'text-primary');
                }
                
                // Ejecutar acciones específicas del tab
                switch(tabId) {
                    case 'ventas':
                        Ventas.renderizarProductos();
                        Ventas.actualizarCarritoUI();
                        break;
                    case 'inventario':
                        Inventario.renderizarInventario();
                        break;
                    case 'reportes':
                        Reportes.cargarReportes();
                        break;
                }
            },
            
            // Tasa BCV
            async cargarTasaBCV() {
                try {
                    // Intentar obtener de API
                    const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                    const data = await response.json();
                    
                    if (data.rates.VES) {
                        this.estado.tasaBCV = data.rates.VES;
                        this.estado.config.tasaManual = false;
                    }
                } catch (error) {
                    console.warn('No se pudo obtener tasa de API, usando valor por defecto');
                    this.estado.tasaBCV = 36.50;
                }
                
                this.actualizarTasaUI();
            },
            
            actualizarTasaUI() {
                const rateElement = document.getElementById('rateValue');
                if (rateElement) {
                    rateElement.textContent = this.estado.tasaBCV.toFixed(2);
                }
            },
            
            mostrarModalTasa() {
                document.getElementById('modalTasa').classList.add('active');
                document.getElementById('referenciaRate').textContent = this.estado.tasaBCV.toFixed(2);
            },
            
            cerrarModalTasa() {
                document.getElementById('modalTasa').classList.remove('active');
            },
            
            async obtenerTasaReferencia() {
                try {
                    const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                    const data = await response.json();
                    
                    if (data.rates.VES) {
                        document.getElementById('referenciaRate').textContent = data.rates.VES.toFixed(2);
                        this.mostrarToast('Tasa actualizada', 'success');
                    }
                } catch (error) {
                    this.mostrarToast('Error obteniendo tasa', 'error');
                }
            },
            
            guardarTasaManual() {
                const input = document.getElementById('tasaManualInput');
                const tasa = parseFloat(input.value);
                
                if (tasa && tasa > 0) {
                    this.estado.tasaBCV = tasa;
                    this.estado.config.tasaManual = true;
                    this.actualizarTasaUI();
                    this.cerrarModalTasa();
                    this.mostrarToast('Tasa guardada correctamente', 'success');
                } else {
                    this.mostrarToast('Ingrese una tasa válida', 'error');
                }
            },
            
            // Carga de datos
            async cargarDatosIniciales() {
                await this.cargarTasaBCV();
            },
            
            // Hora del servidor
            actualizarHoraServidor() {
                this.estado.config.serverTime = new Date();
            },
            
            // Eventos
            configurarEventos() {
                // Login form
                document.getElementById('loginForm')?.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;
                    const btn = document.getElementById('loginBtn');
                    
                    // Cambiar estado del botón
                    const originalHTML = btn.innerHTML;
                    btn.innerHTML = '<i data-lucide="loader" class="w-5 h-5 animate-spin"></i> CARGANDO...';
                    btn.disabled = true;
                    
                    await this.iniciarSesion(email, password);
                    
                    // Restaurar botón
                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                });
            },
            
            // Utilidades
            mostrarToast(mensaje, tipo = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast toast-${tipo}`;
                toast.textContent = mensaje;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            },
            
            formatearMoneda(monto, moneda = 'USD') {
                if (moneda === 'USD') {
                    return `$${parseFloat(monto).toFixed(2)}`;
                } else {
                    return `${parseFloat(monto).toFixed(2)} Bs`;
                }
            },
            
            generarID() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }
        };
        
        // ===== MÓDULO DE VENTAS =====
        const Ventas = {
            carrito: [],
            metodoPago: 'EFECTIVO',
            
            async cargarProductosVenta() {
                // Usar productos del sistema
                return Sistema.estado.productos;
            },
            
            renderizarProductos() {
                const container = document.getElementById('productGrid');
                if (!container) return;
                
                container.innerHTML = '';
                
                Sistema.estado.productos.forEach(producto => {
                    const card = this.crearCardProducto(producto);
                    container.appendChild(card);
                });
            },
            
            crearCardProducto(producto) {
                const div = document.createElement('div');
                div.className = 'bg-white rounded-xl shadow border border-slate-200 p-4 card-hover';
                div.innerHTML = `
                    <div class="mb-3">
                        <span class="text-xs font-semibold text-slate-500">${producto.categoria || 'General'}</span>
                        <h4 class="font-bold text-slate-800 truncate">${producto.name_p}</h4>
                        <p class="text-xs text-slate-500 font-mono">${producto.id_p || producto.id}</p>
                    </div>
                    
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <span class="text-lg font-bold text-primary">${Sistema.formatearMoneda(producto.price_usd)}</span>
                            <p class="text-xs text-slate-500">${(producto.price_usd * Sistema.estado.tasaBCV).toFixed(2)} Bs</p>
                        </div>
                        <span class="badge ${producto.stock > 10 ? 'badge-success' : producto.stock > 0 ? 'badge-warning' : 'badge-danger'}">
                            ${producto.stock} unidades
                        </span>
                    </div>
                    
                    <button onclick="Ventas.agregarAlCarrito('${producto.id}')" 
                            ${producto.stock <= 0 ? 'disabled' : ''}
                            class="w-full btn-primary py-2 rounded-lg text-white font-semibold ${producto.stock <= 0 ? 'opacity-50 cursor-not-allowed' : ''}">
                        <i data-lucide="shopping-cart" class="w-4 h-4 inline mr-2"></i>
                        Agregar
                    </button>
                `;
                
                return div;
            },
            
            agregarAlCarrito(productoId) {
                const producto = Sistema.estado.productos.find(p => p.id === productoId);
                if (!producto) return;
                
                // Verificar stock
                if (producto.stock <= 0) {
                    Sistema.mostrarToast('Producto sin stock', 'error');
                    return;
                }
                
                // Buscar si ya está en el carrito
                const itemIndex = this.carrito.findIndex(item => item.producto.id === productoId);
                
                if (itemIndex >= 0) {
                    // Incrementar cantidad
                    if (this.carrito[itemIndex].cantidad < producto.stock) {
                        this.carrito[itemIndex].cantidad++;
                    } else {
                        Sistema.mostrarToast('No hay suficiente stock', 'error');
                        return;
                    }
                } else {
                    // Agregar nuevo item
                    this.carrito.push({
                        producto: producto,
                        cantidad: 1
                    });
                }
                
                this.actualizarCarritoUI();
                Sistema.mostrarToast('Producto agregado al carrito', 'success');
            },
            
            removerDelCarrito(index) {
                this.carrito.splice(index, 1);
                this.actualizarCarritoUI();
                Sistema.mostrarToast('Producto removido', 'info');
            },
            
            actualizarCantidad(index, nuevaCantidad) {
                if (nuevaCantidad < 1) {
                    this.removerDelCarrito(index);
                    return;
                }
                
                const producto = this.carrito[index].producto;
                if (nuevaCantidad > producto.stock) {
                    Sistema.mostrarToast(`Solo hay ${producto.stock} unidades disponibles`, 'error');
                    return;
                }
                
                this.carrito[index].cantidad = nuevaCantidad;
                this.actualizarCarritoUI();
            },
            
            actualizarCarritoUI() {
                const container = document.getElementById('cartItems');
                const countElement = document.getElementById('cartCount');
                const subtotalElement = document.getElementById('subtotalUSD');
                const totalElement = document.getElementById('totalVES');
                const procesarBtn = document.getElementById('btnProcesarVenta');
                
                // Actualizar contador
                countElement.textContent = this.carrito.length;
                
                // Calcular totales
                let subtotalUSD = 0;
                
                this.carrito.forEach(item => {
                    subtotalUSD += item.producto.price_usd * item.cantidad;
                });
                
                const totalVES = subtotalUSD * Sistema.estado.tasaBCV;
                
                // Actualizar elementos
                subtotalElement.textContent = Sistema.formatearMoneda(subtotalUSD);
                totalElement.textContent = Sistema.formatearMoneda(totalVES, 'VES');
                
                // Habilitar/deshabilitar botón
                procesarBtn.disabled = this.carrito.length === 0;
                
                // Renderizar items
                container.innerHTML = '';
                
                if (this.carrito.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-slate-400">
                            <i data-lucide="shopping-cart" class="w-12 h-12 mx-auto mb-3 opacity-30"></i>
                            <p class="text-sm font-medium">Carrito vacío</p>
                        </div>
                    `;
                    return;
                }
                
                this.carrito.forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'flex items-center justify-between p-3 bg-slate-50 rounded-lg';
                    itemDiv.innerHTML = `
                        <div class="flex-1">
                            <h5 class="font-semibold text-slate-800 text-sm">${item.producto.name_p}</h5>
                            <p class="text-xs text-slate-500">${Sistema.formatearMoneda(item.producto.price_usd)} c/u</p>
                        </div>
                        
                        <div class="flex items-center gap-2">
                            <button onclick="Ventas.actualizarCantidad(${index}, ${item.cantidad - 1})" 
                                    class="w-8 h-8 flex items-center justify-center rounded-lg bg-slate-200 hover:bg-slate-300">
                                <i data-lucide="minus" class="w-3 h-3"></i>
                            </button>
                            
                            <span class="w-8 text-center font-bold">${item.cantidad}</span>
                            
                            <button onclick="Ventas.actualizarCantidad(${index}, ${item.cantidad + 1})" 
                                    class="w-8 h-8 flex items-center justify-center rounded-lg bg-slate-200 hover:bg-slate-300">
                                <i data-lucide="plus" class="w-3 h-3"></i>
                            </button>
                            
                            <button onclick="Ventas.removerDelCarrito(${index})" 
                                    class="w-8 h-8 flex items-center justify-center rounded-lg bg-red-100 hover:bg-red-200 text-red-600 ml-2">
                                <i data-lucide="trash-2" class="w-3 h-3"></i>
                            </button>
                        </div>
                    `;
                    container.appendChild(itemDiv);
                });
            },
            
            seleccionarMetodoPago(metodo) {
                this.metodoPago = metodo;
                
                // Actualizar UI
                document.querySelectorAll('.payment-method').forEach(btn => {
                    btn.classList.remove('border-primary', 'bg-primary', 'text-white');
                    btn.classList.add('bg-slate-100', 'text-slate-700');
                });
                
                const btnSeleccionado = document.querySelector(`.payment-method[data-method="${metodo}"]`);
                if (btnSeleccionado) {
                    btnSeleccionado.classList.remove('bg-slate-100', 'text-slate-700');
                    btnSeleccionado.classList.add('border-primary', 'bg-primary', 'text-white');
                }
            },
            
            vaciarCarrito() {
                Swal.fire({
                    title: '¿Vaciar carrito?',
                    text: 'Se eliminarán todos los productos',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Sí, vaciar',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    if (result.isConfirmed) {
                        this.carrito = [];
                        this.actualizarCarritoUI();
                        Sistema.mostrarToast('Carrito vaciado', 'info');
                    }
                });
            },
            
            async procesarVenta() {
                if (this.carrito.length === 0) {
                    Sistema.mostrarToast('El carrito está vacío', 'error');
                    return;
                }
                
                // Verificar stock
                for (const item of this.carrito) {
                    if (item.cantidad > item.producto.stock) {
                        Sistema.mostrarToast(`Stock insuficiente de ${item.producto.name_p}`, 'error');
                        return;
                    }
                }
                
                Swal.fire({
                    title: 'Confirmar Venta',
                    html: `
                        <div class="text-left">
                            <p class="mb-2"><strong>Productos:</strong> ${this.carrito.length}</p>
                            <p class="mb-2"><strong>Total USD:</strong> ${this.calcularTotalUSD()}</p>
                            <p class="mb-4"><strong>Total Bs:</strong> ${this.calcularTotalVES()}</p>
                            <p><strong>Método:</strong> ${this.metodoPago}</p>
                        </div>
                    `,
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Confirmar Venta',
                    cancelButtonText: 'Cancelar'
                }).then(async (result) => {
                    if (result.isConfirmed) {
                        await this.registrarVenta();
                    }
                });
            },
            
            calcularTotalUSD() {
                return this.carrito.reduce((total, item) => {
                    return total + (item.producto.price_usd * item.cantidad);
                }, 0).toFixed(2);
            },
            
            calcularTotalVES() {
                return (this.calcularTotalUSD() * Sistema.estado.tasaBCV).toFixed(2);
            },
            
            async registrarVenta() {
                try {
                    pb = new PocketBase('https://sisov-pro-react-production.up.railway.app');
                    
                    // Preparar datos de la venta
                    const ventaData = {
                        user_id: Sistema.estado.usuario.id,
                        user_email: Sistema.estado.usuario.email,
                        user_role: Sistema.estado.usuario.rol,
                        n_factura: `FAC-${Date.now().toString().slice(-6)}`,
                        dolartoday: Sistema.estado.tasaBCV,
                        total_usd: parseFloat(this.calcularTotalUSD()),
                        total_ves: parseFloat(this.calcularTotalVES()),
                        items: this.carrito.map(item => ({
                            producto: item.producto.name_p,
                            cantidad: item.cantidad,
                            precio_unitario: item.producto.price_usd,
                            subtotal: item.producto.price_usd * item.cantidad
                        })),
                        payment_method: this.metodoPago,
                        payment_details: {}
                    };
                    
                    // Registrar venta
                    await pb.collection('sales').create(ventaData);
                    
                    // Actualizar stock de productos
                    for (const item of this.carrito) {
                        const nuevoStock = item.producto.stock - item.cantidad;
                        await pb.collection('products').update(item.producto.id, {
                            stock: nuevoStock
                        });
                        
                        // Actualizar en estado local
                        const productoIndex = Sistema.estado.productos.findIndex(p => p.id === item.producto.id);
                        if (productoIndex >= 0) {
                            Sistema.estado.productos[productoIndex].stock = nuevoStock;
                        }
                    }
                    
                    // Registrar en logs
                    await pb.collection('system_logs').create({
                        type: 'VENTA',
                        message: `Venta procesada por ${Sistema.estado.usuario.nombre}`,
                        user: Sistema.estado.usuario.email,
                        context: {
                            factura: ventaData.n_factura,
                            total_usd: ventaData.total_usd,
                            items: ventaData.items.length
                        }
                    });
                    
                    // Limpiar carrito
                    this.carrito = [];
                    this.actualizarCarritoUI();
                    
                    // Actualizar UI
                    Ventas.renderizarProductos();
                    Inventario.renderizarInventario();
                    
                    Sistema.mostrarToast('Venta procesada exitosamente', 'success');
                    
                } catch (error) {
                    console.error('Error procesando venta:', error);
                    Sistema.mostrarToast('Error al procesar la venta', 'error');
                }
            },
            
            // Scanner QR
            iniciarScanner() {
                document.getElementById('modalScanner').classList.add('active');
                
                // Inicializar scanner (implementación básica)
                setTimeout(() => {
                    Sistema.mostrarToast('Escáner listo - Apunte al código QR', 'info');
                }, 500);
            },
            
            detenerScanner() {
                document.getElementById('modalScanner').classList.remove('active');
            },
            
            // Búsqueda
            buscarProductos(termino) {
                const container = document.getElementById('productGrid');
                if (!container) return;
                
                termino = termino.toLowerCase();
                
                const productosFiltrados = Sistema.estado.productos.filter(producto => {
                    return producto.name_p.toLowerCase().includes(termino) ||
                           (producto.id_p && producto.id_p.toLowerCase().includes(termino)) ||
                           (producto.categoria && producto.categoria.toLowerCase().includes(termino));
                });
                
                container.innerHTML = '';
                
                productosFiltrados.forEach(producto => {
                    const card = this.crearCardProducto(producto);
                    container.appendChild(card);
                });
            }
        };
        
        // ===== MÓDULO DE INVENTARIO =====
        const Inventario = {
            async cargarProductos() {
                try {
                    pb = new PocketBase('https://sisov-pro-react-production.up.railway.app');
                    const productos = await pb.collection('products').getFullList();
                    Sistema.estado.productos = productos;
                } catch (error) {
                    console.error('Error cargando productos:', error);
                    Sistema.mostrarToast('Error cargando productos', 'error');
                }
            },
            
            renderizarInventario() {
                const container = document.getElementById('inventoryTable');
                if (!container) return;
                
                container.innerHTML = '';
                
                Sistema.estado.productos.forEach(producto => {
                    const row = this.crearFilaProducto(producto);
                    container.appendChild(row);
                });
            },
            
            crearFilaProducto(producto) {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-slate-50';
                tr.innerHTML = `
                    <td class="p-4">
                        <div>
                            <h4 class="font-semibold text-slate-800">${producto.name_p}</h4>
                            <p class="text-xs text-slate-500">ID: ${producto.id_p || producto.id.slice(0, 8)}</p>
                        </div>
                    </td>
                    <td class="p-4">
                        <span class="font-mono text-sm">${producto.id_p || 'N/A'}</span>
                    </td>
                    <td class="p-4">
                        <span class="badge ${producto.stock > 10 ? 'badge-success' : producto.stock > 0 ? 'badge-warning' : 'badge-danger'}">
                            ${producto.stock} unidades
                        </span>
                    </td>
                    <td class="p-4">
                        <span class="font-bold text-slate-800">${Sistema.formatearMoneda(producto.price_usd)}</span>
                    </td>
                    <td class="p-4">
                        <span class="text-sm text-slate-600">${producto.category || 'General'}</span>
                    </td>
                    <td class="p-4">
                        <div class="flex gap-2">
                            <button onclick="Inventario.editarProducto('${producto.id}')" 
                                    class="p-2 text-primary hover:bg-primary hover:text-white rounded-lg transition-colors">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button onclick="Inventario.eliminarProducto('${producto.id}')" 
                                    class="p-2 text-danger hover:bg-danger hover:text-white rounded-lg transition-colors">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                return tr;
            },
            
            mostrarModalProducto(productoId = null) {
                const modal = document.getElementById('modalProducto');
                const title = document.getElementById('modalProductTitle');
                const form = document.getElementById('productForm');
                
                if (productoId) {
                    // Modo edición
                    const producto = Sistema.estado.productos.find(p => p.id === productoId);
                    if (producto) {
                        title.textContent = 'Editar Producto';
                        document.getElementById('productId').value = producto.id;
                        document.getElementById('productName').value = producto.name_p;
                        document.getElementById('productSKU').value = producto.id_p || '';
                        document.getElementById('productCategory').value = producto.category || '';
                        document.getElementById('productPrice').value = producto.price_usd;
                        document.getElementById('productStock').value = producto.stock;
                    }
                } else {
                    // Modo nuevo
                    title.textContent = 'Nuevo Producto';
                    form.reset();
                    document.getElementById('productId').value = '';
                }
                
                modal.classList.add('active');
            },
            
            cerrarModalProducto() {
                document.getElementById('modalProducto').classList.remove('active');
            },
            
            async guardarProducto(event) {
                event.preventDefault();
                
                try {
                    pb = new PocketBase('https://sisov-pro-react-production.up.railway.app');
                    
                    const productoData = {
                        name_p: document.getElementById('productName').value,
                        id_p: document.getElementById('productSKU').value,
                        category: document.getElementById('productCategory').value,
                        price_usd: parseFloat(document.getElementById('productPrice').value),
                        stock: parseInt(document.getElementById('productStock').value)
                    };
                    
                    const productoId = document.getElementById('productId').value;
                    
                    if (productoId) {
                        // Actualizar
                        await pb.collection('products').update(productoId, productoData);
                        Sistema.mostrarToast('Producto actualizado', 'success');
                    } else {
                        // Crear nuevo
                        await pb.collection('products').create(productoData);
                        Sistema.mostrarToast('Producto creado', 'success');
                    }
                    
                    // Recargar productos
                    await this.cargarProductos();
                    
                    // Actualizar UI
                    this.renderizarInventario();
                    Ventas.renderizarProductos();
                    
                    // Cerrar modal
                    this.cerrarModalProducto();
                    
                } catch (error) {
                    console.error('Error guardando producto:', error);
                    Sistema.mostrarToast('Error guardando producto', 'error');
                }
            },
            
            async eliminarProducto(productoId) {
                Swal.fire({
                    title: '¿Eliminar producto?',
                    text: 'Esta acción no se puede deshacer',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Sí, eliminar',
                    cancelButtonText: 'Cancelar'
                }).then(async (result) => {
                    if (result.isConfirmed) {
                        try {
                            pb = new PocketBase('https://sisov-pro-react-production.up.railway.app');
                            await pb.collection('products').delete(productoId);
                            
                            // Actualizar estado local
                            Sistema.estado.productos = Sistema.estado.productos.filter(p => p.id !== productoId);
                            
                            // Actualizar UI
                            this.renderizarInventario();
                            Ventas.renderizarProductos();
                            
                            Sistema.mostrarToast('Producto eliminado', 'success');
                        } catch (error) {
                            Sistema.mostrarToast('Error eliminando producto', 'error');
                        }
                    }
                });
            },
            
            editarProducto(productoId) {
                this.mostrarModalProducto(productoId);
            },
            
            filtrarProductos(filtro) {
                let productosFiltrados = [...Sistema.estado.productos];
                
                switch(filtro) {
                    case 'bajo':
                        productosFiltrados = productosFiltrados.filter(p => p.stock > 0 && p.stock <= 10);
                        break;
                    case 'agotado':
                        productosFiltrados = productosFiltrados.filter(p => p.stock === 0);
                        break;
                }
                
                const container = document.getElementById('inventoryTable');
                if (!container) return;
                
                container.innerHTML = '';
                
                productosFiltrados.forEach(producto => {
                    const row = this.crearFilaProducto(producto);
                    container.appendChild(row);
                });
            },
            
            buscarEnInventario(termino) {
                const container = document.getElementById('inventoryTable');
                if (!container) return;
                
                termino = termino.toLowerCase();
                
                const productosFiltrados = Sistema.estado.productos.filter(producto => {
                    return producto.name_p.toLowerCase().includes(termino) ||
                           (producto.id_p && producto.id_p.toLowerCase().includes(termino)) ||
                           (producto.category && producto.category.toLowerCase().includes(termino));
                });
                
                container.innerHTML = '';
                
                productosFiltrados.forEach(producto => {
                    const row = this.crearFilaProducto(producto);
                    container.appendChild(row);
                });
            }
        };
        
        // ===== MÓDULO DE REPORTES =====
        const Reportes = {
            async cargarReportes() {
                await this.cargarVentasHoy();
                await this.cargarGraficoVentas();
                await this.cargarTopProductos();
            },
            
            async cargarVentasHoy() {
                try {
                    pb = new PocketBase('https://sisov-pro-react-production.up.railway.app');
                    
                    // Obtener fecha de hoy
                    const hoy = new Date().toISOString().split('T')[0];
                    
                    // Filtrar ventas de hoy
                    const ventas = await pb.collection('sales').getFullList({
                        filter: `created >= "${hoy}"`
                    });
                    
                    // Calcular totales
                    const totalUSD = ventas.reduce((sum, venta) => sum + (venta.total_usd || 0), 0);
                    const totalVES = ventas.reduce((sum, venta) => sum + (venta.total_ves || 0), 0);
                    
                    // Actualizar UI
                    document.getElementById('ventasHoyUSD').textContent = Sistema.formatearMoneda(totalUSD);
                    document.getElementById('ventasHoyVES').textContent = Sistema.formatearMoneda(totalVES, 'VES');
                    document.getElementById('transaccionesHoy').textContent = ventas.length;
                    
                    // Actualizar tabla
                    this.actualizarTablaVentas(ventas);
                    
                } catch (error) {
                    console.error('Error cargando ventas:', error);
                }
            },
            
            actualizarTablaVentas(ventas) {
                const container = document.getElementById('salesTable');
                if (!container) return;
                
                container.innerHTML = '';
                
                ventas.forEach(venta => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-slate-50';
                    row.innerHTML = `
                        <td class="p-4">
                            <span class="font-mono text-sm font-semibold">${venta.n_factura || 'N/A'}</span>
                        </td>
                        <td class="p-4">
                            <span class="text-sm text-slate-600">${new Date(venta.created).toLocaleDateString()}</span>
                        </td>
                        <td class="p-4">
                            <span class="text-sm">${venta.user_email}</span>
                        </td>
                        <td class="p-4">
                            <span class="font-bold text-slate-800">${Sistema.formatearMoneda(venta.total_usd)}</span>
                        </td>
                        <td class="p-4">
                            <span class="text-slate-600">${Sistema.formatearMoneda(venta.total_ves, 'VES')}</span>
                        </td>
                        <td class="p-4">
                            <button onclick="Reportes.verDetalleVenta('${venta.id}')" 
                                    class="text-primary hover:text-primary-dark">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                            </button>
                        </td>
                    `;
                    container.appendChild(row);
                });
            },
            
            async cargarGraficoVentas() {
                try {
                    pb = new PocketBase('https://sisov-pro-react-production.up.railway.app');
                    
                    // Obtener ventas de los últimos 7 días
                    const fechaInicio = new Date();
                    fechaInicio.setDate(fechaInicio.getDate() - 7);
                    
                    const ventas = await pb.collection('sales').getFullList({
                        filter: `created >= "${fechaInicio.toISOString().split('T')[0]}"`,
                        sort: 'created'
                    });
                    
                    // Agrupar por día
                    const ventasPorDia = {};
                    ventas.forEach(venta => {
                        const fecha = new Date(venta.created).toLocaleDateString('es-ES', { weekday: 'short' });
                        ventasPorDia[fecha] = (ventasPorDia[fecha] || 0) + venta.total_usd;
                    });
                    
                    // Crear gráfico
                    const ctx = document.getElementById('salesChart').getContext('2d');
                    
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Object.keys(ventasPorDia),
                            datasets: [{
                                label: 'Ventas USD',
                                data: Object.values(ventasPorDia),
                                borderColor: '#4f46e5',
                                backgroundColor: 'rgba(79, 70, 229, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '$' + value;
                                        }
                                    }
                                }
                            }
                        }
                    });
                    
                } catch (error) {
                    console.error('Error creando gráfico:', error);
                }
            },
            
            async cargarTopProductos() {
                try {
                    pb = new PocketBase('https://sisov-pro-react-production.up.railway.app');
                    
                    // Obtener ventas recientes
                    const ventas = await pb.collection('sales').getFullList({
                        filter: `created >= "${new Date().toISOString().split('T')[0]}"`
                    });
                    
                    // Contar productos vendidos
                    const conteoProductos = {};
                    
                    ventas.forEach(venta => {
                        if (venta.items && Array.isArray(venta.items)) {
                            venta.items.forEach(item => {
                                const nombre = item.producto;
                                conteoProductos[nombre] = (conteoProductos[nombre] || 0) + item.cantidad;
                            });
                        }
                    });
                    
                    // Ordenar por cantidad
                    const topProductos = Object.entries(conteoProductos)
                        .sort((a, b) => b[1] - a[1])
                        .slice(0, 5);
                    
                    // Actualizar UI
                    const container = document.getElementById('topProducts');
                    container.innerHTML = '';
                    
                    topProductos.forEach(([producto, cantidad], index) => {
                        const div = document.createElement('div');
                        div.className = 'flex items-center justify-between p-3 bg-slate-50 rounded-lg';
                        div.innerHTML = `
                            <div class="flex items-center gap-3">
                                <span class="w-6 h-6 flex items-center justify-center bg-primary text-white text-xs font-bold rounded-full">
                                    ${index + 1}
                                </span>
                                <span class="text-sm font-medium">${producto}</span>
                            </div>
                            <span class="font-bold text-primary">${cantidad} u.</span>
                        `;
                        container.appendChild(div);
                    });
                    
                } catch (error) {
                    console.error('Error cargando top productos:', error);
                }
            },
            
            async verDetalleVenta(ventaId) {
                try {
                    pb = new PocketBase('https://sisov-pro-react-production.up.railway.app');
                    const venta = await pb.collection('sales').getOne(ventaId);
                    
                    Swal.fire({
                        title: `Factura: ${venta.n_factura}`,
                        html: `
                            <div class="text-left">
                                <p><strong>Fecha:</strong> ${new Date(venta.created).toLocaleString()}</p>
                                <p><strong>Cliente:</strong> ${venta.user_email}</p>
                                <p><strong>Método de pago:</strong> ${venta.payment_method}</p>
                                <hr class="my-3">
                                <p class="font-bold">Productos:</p>
                                <ul class="list-disc pl-4 mb-3">
                                    ${venta.items ? venta.items.map(item => 
                                        `<li>${item.producto} - ${item.cantidad} x ${Sistema.formatearMoneda(item.precio_unitario)}</li>`
                                    ).join('') : '<li>No hay información de productos</li>'}
                                </ul>
                                <hr class="my-3">
                                <p><strong>Total USD:</strong> ${Sistema.formatearMoneda(venta.total_usd)}</p>
                                <p><strong>Total Bs:</strong> ${Sistema.formatearMoneda(venta.total_ves, 'VES')}</p>
                                <p><strong>Tasa BCV:</strong> ${venta.dolartoday}</p>
                            </div>
                        `,
                        icon: 'info',
                        confirmButtonText: 'Cerrar'
                    });
                    
                } catch (error) {
                    Sistema.mostrarToast('Error cargando detalle de venta', 'error');
                }
            },
            
            async exportarPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Título
                doc.setFontSize(20);
                doc.text('Reporte de Ventas', 20, 20);
                
                // Fecha
                doc.setFontSize(12);
                doc.text(`Fecha: ${new Date().toLocaleDateString()}`, 20, 30);
                
                // Datos
                doc.setFontSize(10);
                doc.text('Este es un reporte generado desde SISOV PRO v3.0/(lite/estable)', 20, 40);
                
                // Guardar PDF
                doc.save(`reporte-ventas-${new Date().toISOString().split('T')[0]}.pdf`);
                
                Sistema.mostrarToast('PDF generado correctamente', 'success');
            }
        };
        
        // ===== MÓDULO DE CONFIGURACIÓN =====
        const Configuracion = {
            async actualizarTasa() {
                const input = document.getElementById('newRate');
                const tasa = parseFloat(input.value);
                
                if (tasa && tasa > 0) {
                    Sistema.estado.tasaBCV = tasa;
                    Sistema.estado.config.tasaManual = true;
                    Sistema.actualizarTasaUI();
                    Sistema.mostrarToast('Tasa actualizada correctamente', 'success');
                    input.value = '';
                } else {
                    Sistema.mostrarToast('Ingrese una tasa válida', 'error');
                }
            },
          //funcion para cargar los usuarios  
          async cargarUsuarios() {
            try {
            pb = new PocketBase('https://sisov-pro-react-production.up.railway.app');
            const usuarios = await pb.collection('users').getFullList();
            
            const container = document.getElementById('usersList');
            container.innerHTML = '';
            
            usuarios.forEach(usuario => {
            const userDiv = document.createElement('div');
                userDiv.className = 'flex items-center justify-between p-4 bg-white rounded-lg border border-slate-200';
                userDiv.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-primary to-purple-600 rounded-full flex items-center justify-center text-white font-bold">
                            ${usuario.user_name?.charAt(0) || usuario.email.charAt(0).toUpperCase()}
                        </div>
                        <div>
                            <h4 class="font-semibold text-slate-800">${usuario.user_name || 'Sin nombre'}</h4>
                            <p class="text-sm text-slate-500">${usuario.email}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="badge ${usuario.user_role === 'admin' ? 'badge-danger' : usuario.user_role === 'vendedor' ? 'badge-warning' : 'badge-success'}">
                            ${usuario.user_role || 'user'}
                        </span>
                        <span class="text-xs ${usuario.verified ? 'text-emerald-600' : 'text-amber-600'}">
                            ${usuario.verified ? '✓ Verificado' : '⏳ Pendiente'}
                        </span>
                    </div>
                `;
                container.appendChild(userDiv);
            });
            
            Sistema.mostrarToast('Usuarios cargados', 'success');
        } catch (error) {
            console.error('Error cargando usuarios:', error);
            Sistema.mostrarToast('Error cargando usuarios', 'error');
        }
    }
};
        
        // ===== INICIALIZACIÓN =====
        document.addEventListener('DOMContentLoaded', async () => {
            // Configurar formulario de producto
            document.getElementById('productForm')?.addEventListener('submit', (e) => {
                Inventario.guardarProducto(e);
            });
            
            // Configurar búsqueda en tiempo real
            document.getElementById('searchProducts')?.addEventListener('input', (e) => {
                Ventas.buscarProductos(e.target.value);
            });
            
            document.getElementById('searchInventory')?.addEventListener('input', (e) => {
                Inventario.buscarEnInventario(e.target.value);
            });
            
            document.getElementById('searchReports')?.addEventListener('input', (e) => {
                // Implementar búsqueda en reportes
            });
            
            // Configurar fecha de reporte
            const reportDate = document.getElementById('reportDate');
            if (reportDate) {
                const hoy = new Date().toISOString().split('T')[0];
                reportDate.value = hoy;
                reportDate.max = hoy;
                
                reportDate.addEventListener('change', () => {
                    // Implementar cambio de fecha en reportes
                });
            }
            
            // Inicializar sistema
            await Sistema.inicializar();
            
            // Verificar conexión al servidor
            try {
                pb = new PocketBase('https://sisov-pro-react-production.up.railway.app');
                await pb.health.check();
                document.getElementById('serverStatus').textContent = 'Conectado';
                document.getElementById('serverStatus').classList.add('text-emerald-500');
            } catch (error) {
                document.getElementById('serverStatus').textContent = 'Desconectado';
                document.getElementById('serverStatus').classList.add('text-red-500');
            }
            
            // Método de pago por defecto
            Ventas.seleccionarMetodoPago('EFECTIVO');
            
            // Actualizar íconos periódicamente
            setInterval(() => {
                lucide.createIcons();
            }, 1000);
        });
        
        // Exponer al scope global para acceso desde HTML
        window.Sistema = Sistema;
        window.Ventas = Ventas;
        window.Inventario = Inventario;
        window.Reportes = Reportes;
        window.Configuracion = Configuracion;
        console.log("%c[NÚCLEO] Comunicación global activada", "color: #3b82f6; font-weight: bold;");
    </script>

    <!-- Al final del body, antes de </body> -->
<div id="floatingButtons" class="fixed bottom-4 right-4 z-50 flex flex-col gap-2">
    <!-- Botón de crear usuario (solo admin) -->
    <div id="createUserFloat" class="hidden">
        <button onclick="window.location.href='crear-usuario.html'"
                class="bg-gradient-to-r from-primary to-purple-600 text-white p-4 rounded-full shadow-lg hover:shadow-xl transition-all flex items-center justify-center">
            <i data-lucide="user-plus" class="w-6 h-6"></i>
        </button>
    </div>
    
    <!-- Botón de ayuda/chat -->
    <button class="bg-slate-800 text-white p-4 rounded-full shadow-lg hover:bg-slate-900 transition-colors">
        <i data-lucide="message-circle" class="w-6 h-6"></i>
    </button>
</div>

<script>
// Mostrar solo si es admin
if (Sistema.estado.usuario?.rol === 'admin') {
    document.getElementById('createUserFloat').classList.remove('hidden');
}
</script>

</body>
</html>